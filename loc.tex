\chapter{位象: 无点拓扑学}

\philoquote{It is in some sense coincidental that $\operatorname{Spec} A$ is described by a topological space. What arises more canonically is the lattice of open subsets of $\operatorname{Spec} A$, which is generated by basic open sets of the form $U_f$. This lattice naturally forms a \emph{locale}\footnotemark{} ...}{Jacob Lurie,\\\emph{Derived Algebraic Geometry V: Structured Spaces}}
\footnotetext{见例 \ref{spectrum-as-locale}.}
%\todo{变成单独的一章?}

\minitoc

常常拓扑空间的重点不在于\emph{点}, 而在于开集, 以及开集之间的关系.
将开集的性质提炼出来, 使其不再依赖于点, 就成为\emph{位象} (locales) 的概念. 它是介于拓扑空间和景之间的一个推广.\footnote{说位象是拓扑空间的 ``推广'' 不甚准确, 因为一般拓扑空间到位象的对应不是全忠实的 (有的空间开集太少). 但是 ``好'' 的空间范畴如 Hausdorff 空间范畴确实嵌入位象的范畴.}
位象理论又称为\emph{无点拓扑学} (pointless topology\footnote{双关笑话: 无点拓扑学不是 pointless (无用的).}). 位象与逻辑的联系表明, 忘掉 ``点'' 并不是一个过分的抽象. 在 $n$-\topos{}的观点中, 位象又可视为 $0$-\topos{}. 正如\topos{}是一种 ``集合宇宙'' 一样, $0$-\topos{}是一种 ``真值宇宙''. %我们将在高阶\topos{}的章节介绍这一点.
因此位象理论某种意义上是\topos{}的前置 (参见 Andr\'e Joyal 的讲座 \cite{Joyal-Crash-Course}). % 建议在\topos{}理论之前先学习位象理论.

\newcommand{\fm}{位格}

\section{基本概念}

\begin{definition}
	[label={frame-definition}]
	{(\fm{})}
	\emph{\fm{}} (frame, 又称 local lattice)\footnotemark 是满足如下条件的偏序集:
	\begin{itemize}
		\item 存在有限交 $\wedge$ 与任意并 $\bigvee$, 其中一族元素的\emph{交} (meet) 是指同时小于等于这些元素的最大元, \emph{并} (join) 是指同时大于等于这些元素的最小元;
		\item 有结合律
		$$
		a \wedge \bigvee_{i \in I} b_i = \bigvee_{i \in I} (a \wedge b_i),
		$$
		其中 $I$ 是任意集合.
	\end{itemize}
	
	\fm{}的态射是偏序集之间保持有限交与任意并的态射. \fm{}的范畴记为 $\mathsf {Frm}$.
\end{definition}
\footnotetext{Frame 一词似乎没有通行的中文翻译. 这里试译为\fm{}, 因为它是一种与拓扑相关的格 (lattice).}
\begin{remark}
	[label={arbitrary-meet}]
	{}
	由于任意交可由任意并表示,
	$$
	\bigwedge A = \bigvee \big\{ b \colon b\leq a \ \forall a\in A\big\},
	$$
	可以证明\fm{}中任意交也存在, 即\fm{}是\emph{完备格} (complete lattice). 但由定义, \fm{}的态射不一定保持任意交.
	\fm{}的结合律说明 $a\wedge({-})$ 保持任意并; 由偏序集的伴随函子定理 (命题 \ref{adjoint-functor-theorem-poset}),
	$a\wedge({-})$ 有右伴随 $a\Rightarrow ({-})$, 因此我们得到\fm{}是\emph{Heyting 代数} (定义 \ref{Heyting-algebra-definition}), 从而是\emph{完备 Heyting 代数}. 但注意\fm{}的同态不一定是 Heyting 代数的同态, 即不一定保持 $\Rightarrow$ 运算. 保持 $\Rightarrow$ 运算的\fm{}同态对应位象的\emph{开映射} (命题 \ref{locale-open-map-preserves-implication}).
\end{remark}

\begin{definition}
	[label={locale-definition}]
	{(位象)}
	\emph{位象} (locale) 是\fm{}的形式对偶,
	即我们定义位象的范畴 $\mathsf {Loc}$ 是位格范畴 $\mathsf {Frm}$ 的对偶范畴.
	对于位象 $X$, 我们记对应的\fm{}为 $\mathcal O(X)$, 称其中的元素为 $X$ 的\emph{开子集}或\emph{开子空间}; 对于位象的态射 $f \colon X \to Y$,
	记对应的\fm{}的态射为 $f^* \colon \mathcal O(Y) \to \mathcal O(X)$.
	
	由于偏序集可视为范畴, 位象可构成一个 $2$-范畴 $\mathcal Loc$ (定义 \ref{2-categories}): 对于 $f,g\colon X\to Y$, 若 $f^*(U)\leq g^*(U)\,(\forall U\in\mathcal O(Y))$, 则有唯一的 $2$-态射 $f\to g$.
\end{definition}

\begin{remark}
	{}
	\fm{}与位象的对偶类似于环与仿射概形的对偶,
	是代数--几何对偶的一例.
	%位象的定义中引入的记号都是为了体现这种对偶.
\end{remark}

\begin{prop}
	[label={morphism-of-locales-as-adjunction}]
	{(位象态射的等价定义)}
	位象的态射 $f\colon X\to Y$ 等同于一对伴随%\footnotemark{}
	% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXG1hdGhjYWwgTyhYKSJdLFsxLDAsIlxcbWF0aGNhbCBPKFkpIl0sWzEsMCwiZl4qIiwyLHsib2Zmc2V0IjoyfV0sWzAsMSwiZl8qIiwyLHsib2Zmc2V0IjoyfV0sWzIsMywiIiwyLHsibGV2ZWwiOjEsInN0eWxlIjp7Im5hbWUiOiJhZGp1bmN0aW9uIn19XV0=
	\[\begin{tikzcd}[ampersand replacement=\&]
		{\mathcal O(X)} \& {\mathcal O(Y),}
		\arrow[""{name=0, anchor=center, inner sep=0}, "{f^*}"', shift right=2, from=1-2, to=1-1]
		\arrow[""{name=1, anchor=center, inner sep=0}, "{f_*}"', shift right=2, from=1-1, to=1-2]
		\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
	\end{tikzcd}\]
	满足 $f^*$ 保持有限交. (注意, $f_*$ 不一定是\fm{}的同态, 即不一定保持任意并.)
\end{prop}
%\footnotetext{这个伴随也可理解为位象构成的 $2$-范畴中的伴随 (定义 \ref{adjoints-in-2-categories}).}
\begin{proof}
	首先, 若有上述伴随 $f^*\dashv f_*$, 则 $f^*$ 保持任意并 (左伴随保持余极限, 命题 \ref{adjoints-preserve-limits}).
	
	另一方面, 若有映射 $f^*\colon \mathcal O(Y)\to\mathcal O(X)$ 保持任意并, 定义
	\[
	f_*(U) := \bigvee \{V\in\mathcal O(Y)\mid f^*(V)\leq U\}.
	\]
	那么
	\[
	f^*f_*(U) = \bigvee \{f^*(V)\mid f^*(V)\leq U\} \leq U.
	\]
	(这是伴随的余单位.)
	由此可得 $V\leq f_*(U) \Leftrightarrow f^*(V)\leq U$, 即 $f^*\dashv f_*$. 这个结论是 ``伴随函子定理'' (注 \ref{adjoint-functor-theorem-poset}) 的特例.
\end{proof}

\begin{example}
	{(拓扑空间作为位象)}
	拓扑空间 $X$ 的开集范畴 $\operatorname{Open}(X)$ 构成一个\fm{}.
	对于连续映射 $f \colon X \to Y$,
	有伴随
	\[\begin{tikzcd}[ampersand replacement=\&]
		{\operatorname{Open}(X)} \& {\operatorname{Open}(Y),}
		\arrow[""{name=0, anchor=center, inner sep=0}, "{f^*}"', shift right=2, from=1-2, to=1-1]
		\arrow[""{name=1, anchor=center, inner sep=0}, "{f_*}"', shift right=2, from=1-1, to=1-2]
		\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
	\end{tikzcd}\]
	其中 $f^*$ 将 $U\in\operatorname{Open}(Y)$ 映射到 $f^{-1}(U)\in\operatorname{Open}(X)$, 保持有限交与任意并; 而 $f_*$ 的表达式为
	\[
	f_*(V) = \bigcup \{\text{$Y$ 的开集 $U$} \mid f^{-1}(U)\subset V\}.
	\]
	由拓扑空间到位象的构造给出函子 $\operatorname{Open} \colon \mathsf {Top} \to \mathsf {Loc}.$
\end{example}


%\begin{example}
%	[label={complete-boolean-algebras}]
%	{(完备 Boole 代数)}
%	Boole 代数是满足如下条件的
%\end{example}

\begin{example}
	[label={initial-locale}]
	{(空位象)}
	空空间 $\varnothing$ 作为位象, 对应的\fm{}是一个元素的全序集 $\{\bot\}$.
	它是 $\mathsf {Loc}$ 的始对象, $\mathsf {Frm}$ 的终对象.
\end{example}

\begin{example}
	[label={terminal-locale}]
	{(点作为位象)}
	单点空间 $\text{pt}$ 对应的位象记作 $1 = \operatorname{Open}(\text{pt})$.
	它对应的位格是两个元素的全序集 $\{\top,\bot\}$ ($\bot < \top$).
	位象 $1$ 也称为\emph{终位象} (terminal locale), 因为它是 $\mathsf {Loc}$ 的终对象, $\mathsf {Frm}$ 的始对象.
\end{example}

\begin{example}
	[label={Sierpinski-space-locale-example}]
	{(Sierpi\'nski 空间)}
	定义 \emph{Sierpi\'nski 空间} $S$ 是以 $\{\top,\bot\}$ 为底层集合的拓扑空间, 有三个开集 $\varnothing, \{\top\}, \{\top,\bot\}$. 那么 $\mathcal O(S)$ 是三个元素的全序集.
	位象 $X$ 到 $S$ 的态射一一对应于 $X$ 的开子空间, 因为\fm{}态射  $\mathcal O(S)\to\mathcal O(X)$ 由 $\{\top\}$ 的像唯一决定.
\end{example}

% 下面的定义表明从位象中可以还原出 ``点'' 的概念.

\begin{definition}
	[label={points-of-locale}]
	{(位象的点)}
	定义位象 $X$ 的\emph{点}为位象的态射 $p\colon 1 \to X$.
	记位象 $X$ 的点的集合为 $\operatorname{Pt}(X)$.
\end{definition}

位象 $X$ 的一个点 $p\colon 1 \to X$ 对应\fm{}态射 $p^*\colon \mathcal O(X) \to \{\bot,\top\}$.
由于它保持有限交与任意并, $p^*$ 的核 ($\top$ 的原像) 是 $\mathcal O(X)$ 的\emph{完全素滤子} (completely prime filter). (偏序集中的\emph{滤子}是关于交封闭的向上封闭子集, 称 $F$ 为完全素滤子是指当 $\bigvee_i U_i \in F$ 时, 至少有一个 $U_i$ 属于 $F$.)

\begin{example}
	[label={spectrum-as-locale}]
	{(环的谱作为位象)}
	在代数几何中, (交换) 环的谱 $\operatorname{Spec}A$ 是由 $A$ 的素理想的集合赋予 Zariski 拓扑定义的. 然而, 我们也可以直接刻画谱的 ``基础开集'' $U_f$ 生成的\fm, 从而不需要使用环的素理想\footnotemark. 定义 $\mathcal O(\operatorname{Spec}A)$ 为如下生成元和关系表现的\fm{}\footnotemark.
	$$
	\mathcal O(\operatorname{Spec}A):= \big\langle U_f\colon f\in A\mid U_0 = \bot, U_1 = \top,
	U_{f+g} \leq U_f \vee U_g, U_{fg} = U_f \wedge U_g \big\rangle.
	$$
	由关系 $U_{fg} = U_f \wedge U_g$, 有限个基础开集的交仍是基础开集, 从而 $\mathcal O(\operatorname{Spec}A)$ 的任何元素都可写成 $\bigvee_i U_{f_i}$ ($f_i\in A$) 的形式; 这解释了 $U_f$ 称为 ``基础开集'' 的原因.
	
	将 $U_f$ 想象为一个空间上函数 $f$ ``非零'' 的地方,
	$f+g$ 非零的地方包含于 $f$ 与 $g$ 各自非零的地方的并,
	而 $fg$ 非零的地方恰为两者的交.
	
	可以证明如此定义的位象 $\operatorname{Spec}A$ 正是传统上定义的拓扑空间 $\operatorname{Spec}A$.
	例如, $\operatorname{Spec}A$ 的点一一对应于\fm{}态射 $\mathcal O(\operatorname{Spec}A)\to\{\top,\bot\}$, 而这等同于对每个生成元 $U_f \,(f\in A)$ 指定 $p(f)\in\{\top,\bot\}$, 满足
	$p(0)=\bot,p(1)=\top,p(fg)=p(f)\land p(g),p(f+g)\leq p(f)\lor p(g)$. 此时 $p^{-1}(\bot)$ 正是 $A$ 的素理想.
	
	对于 $A$ 的一族元素 $\{f_i\}$, 所有开子空间 $U_{f_i}$ 覆盖 $\operatorname{Spec}A$ (即 $\bigvee_i U_{f_i} = \top$) 当且仅当存在一族至多有限个非零的元素 $\{a_i\}$ 使得 $\sum_i a_if_i = 1$, 即 $\{f_i\}$ 生成 $A$ 的单位理想. 这启发了 Zariski 景的定义 (\ref{zariski-site}).
	
	另外, 基础开集 $U_f$ 对应的开子位象同构于局部化的谱 $\operatorname{Spec}A_f$, 并且也有生成元和关系的表现, 见例 \ref{open-sublocale-of-spectrum}.
\end{example}
\addtocounter{footnote}{-1}
\footnotetext{值得一提的是, 构造主义数学青睐这种位象的观点, 因为环的素理想的存在性依赖选择公理. 关于构造主义数学与位象, 我们推荐读者阅读 Andrej Bauer 的文章 \cite{FSCM}.}
\addtocounter{footnote}{1}
\footnotetext{\fm{}就像群, 环等代数结构一样, 可使用生成元和关系刻画, 并且可由给定生成元的 ``自由代数'' 的商得到, 见注 \ref{frame-from-generators-relations}.}


%\begin{remark}
%	[label={completely-prime-filter-vs-prime-ideal}]
%	{}
%	滤子是理想的 ``对偶''. 我们有如下类比: 态射 $\mathcal O(X)\to \{\bot,\top\}$ 中 $\top$ 的原像是完全素滤子, 类似于环同态 $A\to k$ 的核是素理想 ($k$ 为整环). 位象 $X$ 的点对应 $\mathcal O(X)$ 的完全素滤子, 类似于谱 $\operatorname{Spec}A$ 的点对应环 $A$ 的素理想.
%\end{remark}

对每个元素 $U\in\mathcal O(X)$, 规定 $\operatorname{Pt}(X)$ 的子集
$\{p \in \operatorname{Pt}(X) \mid p^*(U) = \top\}$ 为开集,
我们得到了 $\operatorname{Pt}(X)$ 上的一个拓扑. 于是有函子
$$\operatorname{Pt} \colon \mathsf {Loc} \to \mathsf {Top}.$$

\begin{prop}
	[label={top-loc-adjunction}]
	{}
	拓扑空间与位象之间有伴随
	% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXG1hdGhzZiB7VG9wfSJdLFsxLDAsIlxcbWF0aHNmIHtMb2N9Il0sWzAsMSwiXFxvcGVyYXRvcm5hbWV7T3Blbn0iLDAseyJvZmZzZXQiOi0yfV0sWzEsMCwiXFxvcGVyYXRvcm5hbWV7UHR9IiwwLHsib2Zmc2V0IjotMn1dLFsyLDMsIiIsMCx7ImxldmVsIjoxLCJzdHlsZSI6eyJuYW1lIjoiYWRqdW5jdGlvbiJ9fV1d
	\[\begin{tikzcd}[ampersand replacement=\&]
		{\mathsf {Top}} \& {\mathsf {Loc}.}
		\arrow[""{name=0, anchor=center, inner sep=0}, "{\operatorname{Open}}", shift left=2, from=1-1, to=1-2]
		\arrow[""{name=1, anchor=center, inner sep=0}, "{\operatorname{Pt}}", shift left=2, from=1-2, to=1-1]
		\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
	\end{tikzcd}\]
\end{prop}
\begin{proof}
	对于拓扑空间 $S$ 与位象 $X$,
	连续映射 $f\colon S \to \operatorname{Pt}(X)$
	对应\fm{}的态射 $$ \mathcal O(X) \to \operatorname{Open}(S),\quad U\mapsto \{p\in S \mid (f(p))^*(U)=\top\}.$$
	反过来, 态射 $\varphi\colon \mathcal O(X) \to \operatorname{Open}(S)$
	对应连续映射
	\[
	S\to\operatorname{Pt}(X),\quad
	p\mapsto \Big(U\mapsto \Bigl\{\,{\small \begin{aligned}
		\top &\ \ \ p\in\varphi(U)\\
		\bot &\ \ \ p\notin \varphi(U)
	\end{aligned}}\Bigr.\,\Big).
	\]
	容易验证这给出了自然同构
	\[
	\operatorname{Hom}_{\mathsf {Top}}(S,\operatorname{Pt}(X)) \simeq\operatorname{Hom}_{\mathsf {Frm}}(\mathcal O(X),\operatorname{Open}(S)) = \operatorname{Hom}_{\mathsf {Loc}} (\operatorname{Open}(S),X).
	\]
\end{proof}

上述伴随远远不是范畴等价; 首先, 从拓扑空间对应的位象中不一定能重构出原来的拓扑空间, 例如所有平凡拓扑对应的位象都是终位象 $1$.

然而, 对于分离性较好的空间, 其对应的位象确实能重构出这个空间:
\begin{definition}
	[label={sober-space}]
	{(清晰空间)}
	设 $X$ 为拓扑空间. 若命题 \ref{top-loc-adjunction} 中伴随的单位 $X \to \operatorname{Pt}\operatorname{Open}(X)$ 是同胚,
	则称 $X$ 为\emph{清晰空间} (sober space\footnotemark). 换言之, 清晰空间的范畴是上述伴随给出的等价的全子范畴 (命题 \ref{adjoint-full-subcategory-equivalence}).
\end{definition}
\footnotetext{Sober 的原义是清醒, 未喝醉. 直观上一个 sober 空间中的点没有过于 ``糊在一起'', 清晰可辨.}

\begin{prop}
	{}
	Hausdorff ($T_2$) 空间都是清晰空间, 清晰空间都是 $T_0$ 空间; 而清晰与 $T_1$ 互不蕴涵, 例如 Sierpi\'nski 空间清晰而不 $T_1$, 无限集上的余有限拓扑 $T_1$ 而不清晰.
\end{prop}

另一方面, 从一个位象的所有点的信息也无法重构出这个位象: 下面的例子表明一个位象甚至可能没有点!

\begin{example}
	[label={complete-atomless-Boolean-algebra}]
	{(没有点的位象的例子: 完备无原子 Boole 代数)}
	%\emph{Boole 代数}是有二元交, 二元并以及补运算 (满足适当条件) 的偏序集;
	\emph{完备 Boole 代数}是指存在任意交和任意并的 Boole 代数.
	由定义, 完备 Boole 代数是\fm.
	称偏序集中的一个元素为\emph{原子}, 是指除 $\bot$ 以外没有比它更小的元素.
	对任何完备 Boole 代数 $B$, 设 $P$ 是 $B$ 的完全素滤子,
	则 $\bigwedge P$ 是 $B$ 的原子. 这是因为, 假设 $x < \bigwedge P$,
	则 $x\notin P$, 从而由 $\top=x\vee\neg x\in P$, 得 $\neg x \in P$. 这说明 $x<\neg x$, 故 $x=\bot$.
	因此, 完备无原子 Boole 代数对应没有点的位象.
	下面是两个完备无原子 Boole 代数的例子.
	
	\begin{itemize}
		\item 设 $(X,\mathcal A,\mu)$ 为 $\sigma$-有限测度空间, $N\subset \mathcal A$ 为零测集的理想,
		那么商代数 $\mathcal A / N$ 是完备 Boole 代数; 并且当 $\mu$ 无原子 (没有正测度的点) 时, $\mathcal A/N$ 无原子.
		\item	
	设 $X$ 为拓扑空间. 对于开集 $U\subset X$, 定义 $\neg U$ 是 $U$ 的补集的内部.
	考虑偏序集
	$$
	\text{RO}(X)
	=
	\big\{U\in\operatorname{Open}(X)\mid U = \neg\neg U\big\},
	%P\mathbb{N}\big/ \sim,\quadA\sim B \Leftrightarrow A\setminus B, B\setminus A\text{为有限集}.
	%$$% 是 $\mathbb{N}$ 的子集在相差有限个元素的等价关系下构成的偏序集.
	$$
	称为 $X$ 的\emph{正则开集代数} (regular open algebra). 可以证明 $\text{RO}(X)$ 也是一个完备 Boole 代数\footnotemark. 例如其中的任意并由下式给出:
	$$
	\bigvee_{i\in I}U_i = \neg\neg\Big(\bigcup_{i\in I}U_i\Big).
	$$
	
	若取空间 $X$ 为欧氏空间, 则 $\text{RO}(X)$ 没有原子 (任何正则开集内都有一个更小的正则开集). 这是双重否定子位象 (\ref{double-negation-sublocale}) 的特例.
	\end{itemize}
\end{example}
\footnotetext{\url{https://planetmath.org/regularopenalgebra}}

\section{位象的几何性质}

\subsection{子位象}

正如许多 ``空间'' 的概念 (拓扑空间, 向量空间, 概形 ...) 一样, 位象有一种自然的 ``子空间'' 的概念; 当然, 子位象不是通过点集, 而是通过开集的代数定义的. 注意区分底层集合的单 (满) 射与范畴论意义上的单 (满) 态射. 拓扑空间的子空间不等于范畴论意义上的单态射; 类似地, 子位象的定义不是 $\mathsf {Loc}$ 中的单态射, 而是其中的\emph{正则单射} (定义 \ref{regular-epi-and-mono}), 即 $\mathsf {Frm}$ 中的\emph{正则满射}.

\begin{propdef}
	[label={sublocales}]
	{(子位象)}
	对于位象的态射 $f\colon Y\to X$, 以下条件等价:
	\begin{enumerate}
		[(1)]
		\item $f^*\colon \mathcal O(X)\to\mathcal O(Y)$ 为集合的满射;
		\item $f_*\colon \mathcal O(Y)\to\mathcal O(X)$ 为集合的单射;
		\item $f^*f_* = \operatorname{id}_{\mathcal O(Y)}$;
	\end{enumerate}
	称满足上述条件的 $f$ 为\emph{子位象}, 又称位象的\emph{嵌入}.
\end{propdef}
\begin{proof}
	$(3)\Rightarrow (1)$, $(3)\Rightarrow (2)$ 是显然的.
	\begin{itemize}
		\item $(1)\Rightarrow (3)$. 假设 $f^*$ 为满射. 因为 $(f^*f_*)f^* = f^*$ (命题 \ref{locale-map-triangular-identities}), 所以 $f^*f_*=\operatorname{id}_{\mathcal O(X)}$.
		\item $(2)\Rightarrow (3)$. 假设 $f_*$ 为单射. 因为 $f_*(f^*f_*) = f_*$ (命题 \ref{locale-map-triangular-identities}), 所以 $f^*f_*=\operatorname{id}_{\mathcal O(X)}$.
	\end{itemize}
\end{proof}

上面的条件 $(3)$ 是自反子范畴的性质 (\ref{adjoint-full-faithful-unit-iso}) 的特例.

对于子位象 $Y\to X$, $\mathcal O(Y)$ 既可视为 $\mathcal O(X)$ 的商, 又可视为其子集. 以下两个命题分别描述了它作为商集和子集的性质.

%\todo{重写子位象的所有内容, SGL p484, nLab sublocale, Stone Spaces p49}

\begin{prop}
	{}
	对于 $\mathsf {Frm}$ 中的态射 $f^*\colon \mathcal O(Y)\to \mathcal O(X)$, 若 $f^*$ 为集合的满射, 则 $f^*$为正则满射, 即存在子\fm{} $(\equiv_X)\hookrightarrow \mathcal O(Y)\times\mathcal O(Y)$, $$\mathcal O(X) \,=\, \mathcal O(Y) \big/ \!\equiv_X.$$
	当然, 这也等价于 $f$ 为 $\mathsf {Loc}$ 中的正则单射.
\end{prop}

\begin{proof}
	令 $(\equiv_Y)$ 为 $f^*$ (底层集合意义下) 的核偶 (定义 \ref{kernel-pair}). 容易验证它关于有限交与任意并封闭, 即是 $\mathcal O(X)\times\mathcal O(X)$ 的子\fm{}.
\end{proof}

子位象 $Y\to X$ 一一对应于 $\mathcal O(X)$ 上关于有限交与任意并封闭的等价关系 $\equiv_Y$. 直观上, 这个等价关系是说两者与子空间 $Y$ 的 ``交'' 相同.

%\begin{prop}
%	[label={sublocale-as-adjunction}]
%	{(子位象的等价定义)}
%	子位象 (位象的正则单射) $i\colon Y\to X$ 等同于伴随 $i^*\dashv i_*$ (命题 \ref{morphism-of-locales-as-adjunction}), 其中 $i_*$ 为单射.
%\end{prop}
%\begin{proof}
%	\todo{}
%\end{proof}

\begin{prop}
	[label={sublocale-exponential-ideal}]
	{}
	对于子位象 $i\colon Y\to X$, 将 $\mathcal O(Y)$ 通过 $i_*$ 视为 $\mathcal O(X)$ 的子集,
	那么
	\begin{enumerate}[(1)]
		\item $\mathcal O(Y)$ 关于 $\mathcal O(X)$ 中的任意交封闭 (\fm{}中任意交存在, 见注 \ref{arbitrary-meet});
		\item $\mathcal O(Y)$ 上的 ``$\Rightarrow$'' 运算与 $\mathcal O(X)$ 上的一致;
		\item 对任意 $U\in\mathcal O(X)$ 与 $W\in\mathcal O(Y)$, 有 $(U\Rightarrow W)\in \mathcal O(Y)$ (满足此条件的子集称为\emph{指数理想} exponential ideal).
	\end{enumerate}
\end{prop}
\begin{proof}~
	\begin{enumerate}
		[(1)]
		\item 这是因为 $i_*$ 作为右伴随保持极限 (命题 \ref{adjoints-preserve-limits}).
		\item 这是因为 ``$\Rightarrow$'' 运算完全由 ``$\land$'' 决定, 而 $\mathcal O(Y)$ 上的交运算与 $\mathcal O(X)$ 上的一致.
		\item 对任意 $U,V\in\mathcal O(X)$, 由于 $i^*$ 保持有限交且 $i^*i^*=i^*$ (其中我们省略含入映射 $i_*$), 有
		\[
		i^*(V\land U) = i^*(V)\land i^*(U) = i^*i^*(V)\land i^*(U) = i^*(i^*(V)\land U),
		\]
		从而如下条件等价:
		\begin{align*}
			V&\leq (U\Rightarrow W) , &
			V\land U&\leq W, &
			i^*(V\land U)&\leq W,\\
			i^*(i^*(V)\land U)&\leq W,&
			i^*(V)\land U&\leq W,&
			i^*(V)&\leq (U\Rightarrow W).
		\end{align*}
		令 $V=(U\Rightarrow W)$, 知 $i^*(U\Rightarrow W) = (U\Rightarrow W)$, 故 $(U\Rightarrow W)\in \mathcal O(Y)$.
		这个命题是指数理想的判定 (命题 \ref{exponential-ideal-cartesian-closed-reflective-subcategory}) 的特例.
	\end{enumerate}
\end{proof}

子位象之间的包含关系有多种相互等价的表述.

\begin{prop}
	{(子位象之间的包含关系)}
	对于位象 $X$ 的子位象 $i\colon Y\to X,j\colon Z\to X$, 如下条件等价.
	\begin{enumerate}[(1)]
		\item 作为范畴 $\mathsf {Loc}$ 中的子对象有 $Y\leq Z$, 即 $i$ 穿过 $j$;
		\item $i^*$ 穿过 $j^*$, 即 (作为 $\mathcal O(X)\times\mathcal O(X)$ 的子集) $\equiv_Z \,\subset\, \equiv_Y$;
		\item $i_*$ 穿过 $j_*$, 即 (作为 $\mathcal O(X)$ 的子集) $\mathcal O(Y) \subset \mathcal O(Z)$.
	\end{enumerate}
\end{prop}

\begin{proof}
	见命题 \ref{reflective-subcategory-poset}.
\end{proof}

\begin{example}
	{(随机元素的子位象)}
	Alex Simpson 的文章 \cite{SIMPSON20121642} 引入了位象\footnote{准确地说, 是 $\sigma$-位象}上的测度 $\mu\colon \mathcal O(X)\to [0,+\infty]$. 对于位象 $X$ 上的概率测度 $\mu$, 存在一个最大的测度为 $1$ 的子位象 $\operatorname{Ran}_\mu(X)$, 其对应的等价关系为
	$$
	U\equiv_{\operatorname{Ran}_\mu(X)} V \quad \text{当且仅当}\quad \mu(U\cap V) = \mu(U\cup V).
	$$
	使用这个结论可以构造 ``随机序列的位象'', 它是 $0$ 和 $1$ 组成的所有可数序列的空间的 ``子空间'', 但没有任何一个序列属于这个子空间, 因为 ``一个确定的序列永远不是随机序列''. 位象上的测度还可解决 ``分球悖论'': 分球悖论是指球面上不可能给所有子集定义一个旋转不变的测度, 因为一个球可以分成若干不相交的部分, 然后拼成两个同样大的球. 以位象的观点, 这些部分实际上是相交的, 从而不会造成矛盾.
\end{example}

\subsubsection{开子位象与闭子位象}

对于位象 $X$, $\mathcal O(X)$ 的元素可视为其开子空间.

\begin{propdef}
	{(开子位象)}
	设 $X$ 为位象, $W\in\mathcal O(X)$. $X$ 的\emph{开子位象} $W$ 有如下 $4$ 种等价的定义.
	\begin{itemize}
		\item 定义开子位象的嵌入 $i\colon W\to X$ 为一对伴随
		$$\begin{tikzcd}[ampersand replacement=\&]
			{\mathcal O(W)} \& {\mathcal O(X),}
			\arrow[""{name=0, anchor=center, inner sep=0}, "{i^*}"', shift right=2, from=1-2, to=1-1]
			\arrow[""{name=1, anchor=center, inner sep=0}, "{i_*}"', shift right=2, from=1-1, to=1-2]
			\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
		\end{tikzcd}$$
		有两种定义方式,
		\begin{enumerate}
			\item[(1)] $\mathcal O(W)_1 = \{U\in\mathcal O(X)\mid U\leq W\}$,
			$i^* (U) = (W\land U)$,
			$i_*(U) = (W\Rightarrow U).$
			关于 ``$\Rightarrow$'' 运算的定义见 \ref{Heyting-algebra-definition}.
			\item[(2)] $\mathcal O(W)_2 = \{U\in\mathcal O(X)\mid U = (W\Rightarrow U)\}$,
			$i^*(U)=(W\Rightarrow U)$,
			$i_* (U) = U$.
		\end{enumerate}
		\item 定义等价关系 $\equiv_W$, 又有两种定义方式,
		\begin{enumerate}
			\item[(3)]
			$U \equiv_W V \quad \text{当且仅当} \quad (W\land U) = (W \land V).$
			\item[(4)]
			$U \equiv_W V \quad \text{当且仅当} \quad (W\Rightarrow U) = (W\Rightarrow V).$
		\end{enumerate}
	\end{itemize}
\end{propdef}
\begin{proof}
	很明显, 定义 $(1),(3)$ 等价, 定义 $(2),(4)$ 等价.
	\begin{itemize}
		\item 定义 $(1),(2)$ 等价是因为如下的同构.
		% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXHtVXzFcXGluXFxtYXRoY2FsIE8oWClcXG1pZCBVXzFcXGxlcSBXXFx9Il0sWzEsMCwiXFx7VV8yXFxpblxcbWF0aGNhbCBPKFgpXFxtaWQgVV8yPShXXFxSaWdodGFycm93IFVfMilcXH0iXSxbMCwxLCJVXzFcXG1hcHN0byAoV1xcUmlnaHRhcnJvdyBVXzEpIiwyLHsib2Zmc2V0Ijo1fV0sWzEsMCwiVV8yXFxtYXBzdG8gKFdcXGxhbmQgVV8yKSIsMix7Im9mZnNldCI6NX1dLFsyLDMsIlxcc2ltZXEiLDEseyJzaG9ydGVuIjp7InNvdXJjZSI6MjAsInRhcmdldCI6MjB9LCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJub25lIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
		\[\begin{tikzcd}[ampersand replacement=\&]
			{\{U_1\in\mathcal O(X)\mid U_1\leq W\}} \& {\{U_2\in\mathcal O(X)\mid U_2=(W\Rightarrow U_2)\}}
			\arrow[""{name=0, anchor=center, inner sep=0}, "{U_1\mapsto (W\Rightarrow U_1)}"', shift right=4, from=1-1, to=1-2]
			\arrow[""{name=1, anchor=center, inner sep=0}, "{U_2\mapsto (W\land U_2)}"', shift right=4, from=1-2, to=1-1]
			\arrow["\simeq"{description}, draw=none, from=0, to=1]
		\end{tikzcd}\]
		\item 定义 $(3),(4)$ 等价是因为 $(W\Rightarrow U) = (W\Rightarrow (W\land U))$,
		$(W\land U) = (W\land (W\Rightarrow U))$.
	\end{itemize}
\end{proof}

\begin{example}
	[label={open-sublocale-of-spectrum}]
	{(环谱的开子位象)}
	继续例 \ref{spectrum-as-locale}, $\operatorname{Spec}A$ 的基础开集 $U_f$ 对应的开子位象正是 $\operatorname{Spec}A_f$,
	\[
	\begin{aligned}
		\mathcal O(\operatorname{Spec}A_f) &\simeq \{U\in\mathcal O(\operatorname{Spec}A)\mid U\leq U_f\} \\&\simeq \big\langle U_{fg}\colon g\in A\mid U_0 = \bot, U_f=\top, U_{f(g+h)}\leq U_{fg}\lor U_{fh}, U_{fgh}=U_{fg}\land U_{fh}\big\rangle.
	\end{aligned}
	\]
	$\operatorname{Spec}A_f$ 的点一一对应于\fm{}态射 $\mathcal O(\operatorname{Spec}A_f) \to \{\bot,\top\}$, 也即对每个生成元 $U_{fg}$ 指定一个元素 $p(fg)\in \{\top,\bot\}$, 满足 $p(0) = \bot, p(f)=\top, p(f(g+h))\leq p(fg)\lor p(fh), p(fgh)=p(fg)\land p(fh)$. 令 $\mathfrak p=\{g\in A\mid p(fg)=\bot\}$, 则 $\mathfrak p$ 是 $A$ 中不含 $f$ 的素理想, 这与 $\operatorname{Spec}A_f$ 的传统定义相符.
\end{example}

\begin{definition}
	{(闭子位象)}
	设 $X$ 为位象, $W\in\mathcal O(X)$. $X$ 的\emph{闭子位象} $X\setminus W$ 有如下两种等价的定义.
	\begin{itemize}
		\item 定义闭子位象的嵌入 $i\colon (X\setminus W)\to X$ 为一对伴随
		$$\begin{tikzcd}[ampersand replacement=\&]
			{\mathcal O(X\setminus W)} \& {\mathcal O(X),}
			\arrow[""{name=0, anchor=center, inner sep=0}, "{i^*}"', shift right=2, from=1-2, to=1-1]
			\arrow[""{name=1, anchor=center, inner sep=0}, "{i_*}"', shift right=2, from=1-1, to=1-2]
			\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
		\end{tikzcd}$$
		$\mathcal O(X\setminus W) := \{U\in\mathcal O(X)\mid U\geq W\}$, $i^* (U) = U\lor W$, $i_*(U)=U$.
		\item 定义等价关系 $\equiv_{X\setminus W}$,
		$U\equiv_{X\setminus W} V \quad\text{当且仅当}\quad
		U\lor W = V\lor W$.
	\end{itemize}
\end{definition}



%\subsection{测度与随机性}
%
%本小节介绍 Alex Simpson 的文章 \cite{SIMPSON20121642} 引入的\emph{随机序列的位象}. 它是 $0$ 和 $1$ 组成的所有可数序列的空间的 ``子空间'', 但没有任何一个序列属于这个子空间, 因为 ``一个确定的序列永远不是随机序列''.
%
%位象上的测度是测度空间的一个推广. 为简便, 设所考虑的位象都满足 \emph{Lindel\"of 条件}: . 设 $X$ 为位象, 其上的\emph{测度}是满足如下条件的函数 $\mu\colon \mathcal O(X)\to [0,+\infty]$:
%
%\begin{definition}
%	{(位象上的测度)}
%	\begin{itemize}
%		\item $\mu(\bot) = 0$,
%		\item $x\leq y \Rightarrow \mu(x)\leq \mu(y)$,
%		\item $\mu(x)+\mu(y)=\mu(x\vee y)+\mu(x\wedge y)$,
%		\item 对任意 (可数) 递增序列 $x_1\leq x_2\leq\cdots$, $\mu(\bigvee_i x_i)=\sup_{i}\mu(x_i)$.
%	\end{itemize}
%	若 $\mu(\top)=1$, 称 $\mu$ 为\emph{概率测度}.
%\end{definition}
%
%\begin{propdef}
%	{(随机元素的子位象)}
%	设位象 $X$ 上有测度 $\mu$. 定义 $X$ 的 \emph{$\mu$-随机元素的子位象} $\operatorname{Ran}_\mu(X)$ 如下:
%	$$
%	U\equiv_{\operatorname{Ran}_\mu(X)} V \quad \text{当且仅当}\quad \mu(U\cap V) = \mu(U\cup V).
%	$$
%	可以验证 $\equiv_{\operatorname{Ran}_\mu(X)}$ 确实是一个等价关系; 直观上, 这个等价关系是相差一个 $\mu$-零测集.
%\end{propdef}
%
%\begin{prop}
%	{}
%	设 $X$ 为清晰空间, 带有测度 $\mu$, 则 $\operatorname{Ran}_\mu(X)$ 的点一一对应于 $X$ 的原子.
%\end{prop}
%
%\todo{解释原子的含义}
%
%\todo{}

\newcommand{\nc}{内核}

\subsubsection{子位象与\nc{}}

下面引入\emph{\nc{}} (nucleus) 的概念. 它是\topos{}中 Lawvere--Tierney 拓扑 (定义 \ref{Lawvere--Tierney-topology}) 和层化在位象中的类比.

\begin{prop}
	[label={locale-map-triangular-identities}]
	{}
	对位象的态射 $f\colon X\to Y$, 有
	\[
	f^*f_*V \leq V\,(V\in\mathcal O(X)),\quad U\leq f_*f^* U\,(U\in\mathcal O(Y)),
	\]
	\[
	f^*f_*f^* = f^*,\quad
	f_*f^*f_* = f_*.
	\]
\end{prop}
\begin{proof}
	前两式是伴随 $f^*\dashv f_*$ 的余单位和单位, 而后两式由前两式易得. 后两式也包含在伴随函子的一种定义中, 见定义 \ref{adjoints-in-2-categories}).
\end{proof}
对于位象态射 $f$, 记 $j = f_*f^*$, 由上述命题有 $U\leq j(U)$, 且 $jj=j$. 这实际上是 ``伴随产生单子'' (命题 \ref{monad-from-adjoint}).

\begin{definition}
	[label={nuclei}]
	{(\nc{})}
	定义位象 $X$ 的一个\emph{\nc{}} (nucleus) 为满足如下条件的映射 $j\colon \mathcal O(X)\to \mathcal O(X)$,
	\begin{itemize}
		\item $j$ 保持有限交, $j(U\land V) = j(U)\land j(V)$;
		\item $U\leq j(U)$;
		\item $jj=j$.
	\end{itemize}
	其中后两个条件就是说 $j$ 为单子 (定义 \ref{monad-definition}).
	
	对于位象态射 $f\colon X\to Y$, 称 $f_*f^*$ 为 $f$ 诱导的 $Y$ 的\nc{}.
\end{definition}

\begin{definition}
	[label={nucleus-to-sublocale}]
	{(\nc{}对应的子位象)}
	设 $j$ 为 $X$ 的一个\nc{}.
	定义子位象 $X_j$,
	\begin{itemize}
		\item 定义伴随
		\[\begin{tikzcd}[ampersand replacement=\&]
			{\mathcal O(X_j)} \& {\mathcal O(X),}
			\arrow[""{name=0, anchor=center, inner sep=0}, "{i^*}"', shift right=2, from=1-2, to=1-1]
			\arrow[""{name=1, anchor=center, inner sep=0}, "{i_*}"', shift right=2, from=1-1, to=1-2]
			\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=0, to=1]
		\end{tikzcd}\]
		$\mathcal O(X_j) := \{U\in\mathcal O(X)\mid j(U) = U\}$. (由于 $jj=j$, $\mathcal O(X_j)$ 也等于 $\operatorname{im}(j)$.)
		$i^*(U) = j(U)$, $i_*(U) = U$.
		\item 等价关系 $\equiv_{X_j}$ 为 $U\equiv_{X_j} V$ 当且仅当 $j(U)=j(V).$
	\end{itemize}
\end{definition}

例如, 当 $j(U) = U\lor W$ 时, 上述构造给出闭子位象 $X\setminus W$. 当 $j(U) = (W\Rightarrow U)$ 时, 上述构造给出开子位象 $W$.

\begin{prop}
	{}
	位象 $X$ 的\nc{}一一对应于 $X$ 的子位象.
\end{prop}
%\todo{证明, Stone Spaces p49}
\begin{proof}
	由定义 \ref{nucleus-to-sublocale}, \nc{} $j$ 对应的子位象 $i\colon X_j\to X$ 对应的\nc{}为 $i_*i^* = j$.
	
	另一方面, 设 $i\colon W\to X$ 为子位象, $j=i_*i^*$. 我们证明子位象 $X_j$ 同构于 $W$.
	因为 $i_*$ 为单射, $i^*$ 为满射 (定义 \ref{sublocales}),
	所以作为 $\mathcal O(X)$ 的子\fm{}有 $\operatorname{im}(i_*) = \operatorname{im}(j)=\mathcal O(X_j)$.
	故 $X_j, W$ 作为 $X$ 的子位象同构.
\end{proof}


\begin{propdef}
	{(闭包)}
	对于子位象 $i\colon W \hookrightarrow X$, 存在包含 $W$ 的最小闭子位象 $\overline{W}$, 称为 $W$ 的\emph{闭包},
	满足
	\[
	\overline{W} \simeq X\setminus U,\quad U= \bigvee \{V\in\mathcal O(X)\mid i^*(V) =\bot\}.
	\]
	若 $\overline{W} = X$, 则称 $W$ 为\emph{稠密子位象}.
	设 $j\colon \mathcal O(X)\to\mathcal O(X)$ 为子位象 $W$ 对应的内核, 则 $W$ 为稠密子位象当且仅当 $j(\bot) = \bot$, 也即 $\bot\in\mathcal O(W)$.
\end{propdef}

\subsection{Boole 位象}

\begin{definition}
	[label={Boolean-locale}]
	{(Boole 位象)}
	称一个位象为 \emph{Boole 位象} (Boolean locale) 是指其对应的\fm{}为 Boole 代数 (由\fm{}的定义, 它必然是\emph{完备 Boole 代数}).
\end{definition}

有趣的是, 一个位象的所有 Boole 子位象具有非常简单的刻画.

\newcommand{\booleansublocale}[1]{\text{B}(#1)}

\begin{prop}
	[label={xyyy-xy}]
	{}
	在任何 Heyting 代数 $H$ 中有
	\[
	\Big(\big((x\Rightarrow y) \Rightarrow y\big) \Rightarrow y\Big) = (x\Rightarrow y).
	\]
	特别地, 有 $\neg\neg\neg = \neg$.
\end{prop}
\begin{proof}
	这是因为如下的伴随.
	\[\begin{tikzcd}
		{H^{\op}} & {H}
		\arrow[""{name=0, anchor=center, inner sep=0}, "(-)\Rightarrow y"', shift right=2, from=1-1, to=1-2]
		\arrow[""{name=1, anchor=center, inner sep=0}, "(-)\Rightarrow y"', shift right=2, from=1-2, to=1-1]
		\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=1, to=0]
	\end{tikzcd}\]
	对比命题 \ref{locale-map-triangular-identities} 的证明.
\end{proof}

%上述命题表明, $x = \big((x\Rightarrow y) \Rightarrow y\big)$ 当且仅当存在 $z$, $x= (z\Rightarrow y)$.

\begin{propdef}
	[label={Boolean-sublocale}]
	{}
	%\todo{}
	设 $X$ 为位象, $W\in\mathcal O(X)$.
	定义 $\booleansublocale{W}$ 为内核 $j = \big((-\Rightarrow W) \Rightarrow W\big)$ 对应的子位象.
%	定义子位象 $\booleansublocale{W}$ 如下:
%	\begin{itemize}
%		\item 子位象的嵌入 $\booleansublocale{W}\hookrightarrow X$ 为一对伴随
%		% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXG1hdGhjYWwgTyhcXGJvb2xlYW5zdWJsb2NhbGV7V30pIl0sWzEsMCwiXFxtYXRoY2FsIE8oWCkiXSxbMCwxLCJpXyoiLDIseyJvZmZzZXQiOjJ9XSxbMSwwLCJpXioiLDIseyJvZmZzZXQiOjJ9XSxbMywyLCIiLDIseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImFkanVuY3Rpb24ifX1dXQ==
%		\[\begin{tikzcd}[ampersand replacement=\&]
%			{\mathcal O(\booleansublocale{W})} \& {\mathcal O(X),}
%			\arrow[""{name=0, anchor=center, inner sep=0}, "{i_*}"', shift right=2, from=1-1, to=1-2]
%			\arrow[""{name=1, anchor=center, inner sep=0}, "{i^*}"', shift right=2, from=1-2, to=1-1]
%			\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=1, to=0]
%		\end{tikzcd}\]
%		$\mathcal O(\booleansublocale{W}) := \{U\in\mathcal O(X)\mid (U)\}$
%	\end{itemize}
	那么 $\booleansublocale{W}$ 为 Boole 位象, 且 $X$ 的所有 Boole 位象均可表示为这种形式.
\end{propdef}
\begin{proof}
	由命题 \ref{xyyy-xy} 的证明知 $j = \big((-\Rightarrow W) \Rightarrow W\big)$ 为内核,
	且由该命题的结论知
	$$
	\begin{aligned}
		\mathcal O(\booleansublocale{W}) &= \{U\in\mathcal O(X) \mid U=\big((U\Rightarrow W)\Rightarrow W\big)\}\\
		&= \{V\Rightarrow W \mid V\in\mathcal O(X)\}
	\end{aligned}
	$$
	特别地, $\mathcal O(\booleansublocale{W})$ 的最小元为 $W$.
	对任意 $U\in \mathcal O(\booleansublocale{W})$,
	我们证明 $U\Rightarrow W$ 是 $U$ 在 $\mathcal O(\booleansublocale{W})$ 中的补, 从而 $\mathcal O(\booleansublocale{W})$ 为 Boole 代数.
	首先, $U\land (U\Rightarrow W) = W$.
	其次, 对任意 $(V\Rightarrow W)\in \mathcal O(\booleansublocale{W})$,
	假设 $U\leq (V\Rightarrow W)$ 且 $(U\Rightarrow W) \leq (V\Rightarrow W)$.
	那么 $V\leq (U\Rightarrow W) \leq (V\Rightarrow W)$, 从而 $V\leq W$, $(V\Rightarrow W) = \top$.
	
	另一方面, 对任意 Boole 子位象 $i\colon Y\to X$, 将 $\mathcal O(Y)$ 通过 $i_*$ 视为 $\mathcal O(X)$ 的子集,
	设 $\mathcal O(Y)$ 的最小元为 $W$. 对任意 $U,V\in \mathcal O(Y)$,
	\[
	U\land V\leq W \quad\Leftrightarrow \quad U\leq (V\Rightarrow W),
	\]
	因此 $V$ 与 $V\Rightarrow W$ 是 Boole 代数 $\mathcal O(Y)$ 中的互补元素, 这证明了 $\mathcal O(Y)\subset\mathcal O(\booleansublocale{W})$.
	而 $(-\Rightarrow W)$ 的像落在 $\mathcal O(Y)$ 内 (命题 \ref{sublocale-exponential-ideal}),
	故有 $Y = \booleansublocale{W}$.
\end{proof}
由上述证明可知, 对任何子位象 $i\colon Y\to X$, 将 $\mathcal O(Y)$ 通过 $i_*$ 视为 $\mathcal O(X)$ 的子集,
对任意 $W\in\mathcal O(Y)$, 有 $\mathcal O(\booleansublocale{W}) \subset\mathcal O(Y)$,
即 ``$\booleansublocale{W}$ 是包含 $W$ 的最小子位象'', 其中子位象按照上述方式视为 $\mathcal O(X)$ 的子集.

\begin{example}
	[label={double-negation-sublocale}]
	{(双重否定子位象)}
	在定义 \ref{Boolean-sublocale} 中取 $W=\bot$ 就得到\emph{双重否定子位象},
%	设 $\mathcal O(X)$ 是\fm{}, \emph{双重否定} (double negation) $\neg\neg\colon \mathcal O(X)\to\mathcal O(X)$ 是一个内核, 因为它是伴随
%	% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXG1hdGhjYWwgTyhYKV57XFxvcH0iXSxbMSwwLCJcXG1hdGhjYWwgTyhYKSJdLFswLDEsIlxcbmVnIiwyLHsib2Zmc2V0IjoyfV0sWzEsMCwiXFxuZWciLDIseyJvZmZzZXQiOjJ9XSxbMywyLCIiLDIseyJsZXZlbCI6MSwic3R5bGUiOnsibmFtZSI6ImFkanVuY3Rpb24ifX1dXQ==
%	\[\begin{tikzcd}
%		{\mathcal O(X)^{\op}} & {\mathcal O(X)}
%		\arrow[""{name=0, anchor=center, inner sep=0}, "\neg"', shift right=2, from=1-1, to=1-2]
%		\arrow[""{name=1, anchor=center, inner sep=0}, "\neg"', shift right=2, from=1-2, to=1-1]
%		\arrow["\dashv"{anchor=center, rotate=-90}, draw=none, from=1, to=0]
%	\end{tikzcd}\]
%	对应的单子, $\neg\neg\neg\neg = \neg\neg$. (这个伴随的道理与幂集函子类似, 见例 \ref{contravariant-power-set-self-adjunction}.)
	即内核 $\neg\neg$ 对应的子位象, 记之为 $X_{\neg\neg}\hookrightarrow X$.
	% $X_{\neg\neg}$ 是 $X$ 的最大 Boole 子位象吗?
	称 $\mathcal O(X_{\neg\neg}) = \{U\in\mathcal O(X)\mid U = \neg\neg U\}$ 的元素为 $\mathcal O(X)$ 的\emph{正则元素} (见例 \ref{complete-atomless-Boolean-algebra}).
	由前面的讨论, $X_{\neg\neg}$ 是 $X$ 的最小稠密子位象.
	在\topos{}的层面, 双重否定作为 Lawvere--Tierney 拓扑给出一个 Boole 子\topos{}, 在力迫法中有重要的应用 (见 \ref{Cohen-forcing} 节).
\end{example}

\subsection{位象的满射}

前面研究了位象的正则单射. 位象的满射与之并非完全对偶. 不同之处在于 $\mathsf {Frm}$ 中的单态射等同于底层集合上的单射. 这是因为遗忘函子 $\mathsf {Frm}\to\mathsf {Set}$ 保持极限.

\begin{propdef}
	[label={surjection-of-locales}]
	{(位象的满射)}
	对于位象的态射 $f\colon X\to Y$, 以下条件等价:
	\begin{enumerate}[(1)]
		\item $f^*\colon \mathcal O(Y)\to\mathcal O(X)$ 为集合的单射;
		\item $f_*\colon \mathcal O(X)\to\mathcal O(Y)$ 为集合的满射;
		\item $f_*f^* = \operatorname{id}_{\mathcal O(Y)}$.
	\end{enumerate}
	称满足上述条件的 $f$ 为位象的\emph{满射}.
\end{propdef}
\begin{proof}
	$(3)\Rightarrow (1)$, $(3)\Rightarrow (2)$ 是显然的.
	\begin{itemize}
		\item $(1)\Rightarrow (3)$. 假设 $f^*$ 为单射. 因为 $f^*(f_*f^*) = f^*$ (命题 \ref{locale-map-triangular-identities}), 所以 $f_*f^*=\operatorname{id}_{\mathcal O(Y)}$.
		\item $(2)\Rightarrow (3)$. 假设 $f_*$ 为满射. 因为 $(f_*f^*)f_* = f_*$ (命题 \ref{locale-map-triangular-identities}), 所以 $f_*f^*=\operatorname{id}_{\mathcal O(Y)}$.
	\end{itemize}
\end{proof}

\begin{prop}
	[label={locale-epi-mono-decomposition-existence}]
	{(位象的满--单分解, 存在性)}
	设 $f\colon X\to Y$ 为位象态射.
	存在 $Y$ 上的内核 $j$ 使得 $f$ 分解为满射 $X\to Y_j$ 与嵌入 $Y_j\hookrightarrow Y$ 的复合.
\end{prop}
\begin{proof}
	令 $j = f_*f^*$ 为 $f$ 诱导的内核, 则有 $f^* = f^*f_*f^* = f^*j$.
	定义 $p\colon X\to Y_j$, $p^* = f^*\big|_{\mathcal O(Y_j)}$ (回忆 $\mathcal O(Y_j) = \{U\in\mathcal O(Y)\mid j(U)=U\}$),
	则 $f^*=p^*j$, $f$ 分解为 $X\overset{p}{\to} Y_j \hookrightarrow Y$.
	对任意 $U,V\in\mathcal O(Y_j)$, 若 $p^*(U)=p^*(V)$, 则 $U=j(U)=j(V)=V$, 这说明 $p^*$ 单, 即 $p$ 为满射.
\end{proof}

\begin{prop}
	{(位象的满--单分解, 唯一性)}
	设 $f\colon X\to Y$ 为位象态射, $f$ 有两个分解 $f=X\overset{p}{\to} A\overset{u}{\to} Y = X\overset{q}{\to} B\overset{v}{\to} Y$.
	假设 $v$ 为嵌入, $p$ 为满射, 那么存在唯一的态射 $g\colon A\to B$ 使下图交换;
	% https://q.uiver.app/#q=WzAsNCxbMCwxLCJYIl0sWzEsMCwiQSJdLFsyLDEsIlkiXSxbMSwyLCJCIl0sWzAsMSwicCJdLFsxLDIsInUiXSxbMCwzLCJxIiwyLHsic3R5bGUiOnsiaGVhZCI6eyJuYW1lIjoiZXBpIn19fV0sWzMsMiwidiIsMix7InN0eWxlIjp7InRhaWwiOnsibmFtZSI6Imhvb2siLCJzaWRlIjoiYm90dG9tIn19fV0sWzEsMywiXFxleGlzdHMgISIsMSx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX1dXQ==
	\[\begin{tikzcd}[ampersand replacement=\&,row sep=small]
		\& A \\
		X \&\& Y \\
		\& B
		\arrow["p", two heads, from=2-1, to=1-2]
		\arrow["u", from=1-2, to=2-3]
		\arrow["q"', from=2-1, to=3-2]
		\arrow["v"', hook', from=3-2, to=2-3]
		\arrow["{\exists ! g}"{description}, dashed, from=1-2, to=3-2]
	\end{tikzcd}\]
	进一步假设 $u$ 为嵌入, $q$ 为满射, 则 $g$ 为同构.
\end{prop}
\begin{proof}
	对 $v$ 使用命题 \ref{locale-epi-mono-decomposition-existence},
	得分解 $v=B\overset{r}{\to} Y_j\overset{i}{\hookrightarrow} Y$, 那么 $r$ 既单又满, 故为同构.
	不妨设 $B = Y_j$, $v^* = j$.
	
	注意到对于位象态射 $f\colon X\to Y$, $f$ 穿过 $Y_j$ 当且仅当 $f^*$ 穿过 $j$, 当且仅当 $f^* j = f^*$.
	代入 $f=up$ 得 $p^*u^* j = p^*u^*$.
	由 $p^*$ 为单射得 $u^*j = u^*$, 故 $u$ 穿过 $Y_j$. 由于 $Y_j\to Y$ 为单射, 态射 $g\colon A\to B$ 当然是唯一的.
	因为 $vgp = up = vq$, $v$ 为嵌入, 所以 $gp=q$.
	
	进一步假设 $u$ 为嵌入, $q$ 为满射, 则 $u=vg$ 推出 $g$ 单, $q=gp$ 推出 $g$ 满, 从而 $g$ 为同构.
\end{proof}

\subsection{开映射}

% SGL p502
% Elephant C1.5.3

拓扑空间的开映射 $f\colon X\to Y$ 是指将开集映为开集的映射. 对开集 $U\in\operatorname{Open}(X)$, 存在开集
$f_!(U) \in \operatorname{Open}(Y)$ 构成开集 $U$ 在 $Y$ 中的像, 即逆像包含 $U$ 的最小开集, 这个性质可表述为 $f_!$ 是 $f^*$ 的左伴随:
\[
f_!(U) \subset V \,\Leftrightarrow\, U\subset f^*(V).
\]
此外还有如下的 \emph{Frobenius 恒等式},
\[
f_!(U\cap f^*(V)) = f_!(U)\cap V.
\]

\begin{definition}
	[label={locale-open-map}]
	{}
	对于位象的态射 $f\colon X\to Y$, 若 $f^* \colon \mathcal O(Y)\to \mathcal O(X)$ 有左伴随 $f_!$, 且满足 Frobenius 恒等式 $f_!(U\land f^*(V)) = f_!(U)\land V$, 则称 $f$ 为\emph{开映射}.
\end{definition}

\begin{prop}
	[label={locale-open-map-preserves-implication}]
	{}
	位象的态射 $f\colon X\to Y$ 为开映射当且仅当 $f^*$ 为\emph{完备 Heyting 代数}的同态, 即 $f^*$ 保持任意交, 且保持 $\Rightarrow$ 运算.
\end{prop}
\begin{proof}
	$f^*$ 保持任意交当且仅当 $f^*$ 有左伴随 (命题 \ref{adjoint-functor-theorem-poset}), 而 $f^*$ 保持 $\Rightarrow$ 运算是 Frobenius 互反律的等价条件 (命题 \ref{ccc-Frobenius-pullback-preserve-exp}).
\end{proof}

\begin{prop}
	{}
	子位象 $i\colon Y\to X$ 是开子位象当且仅当 $i$ 是开映射.
\end{prop}
\begin{proof}
	设 $i\colon Y\to X$ 是开子位象, $Y\in\mathcal O(X)$, $\mathcal O(Y) = \{U\in\mathcal O(X)\mid U\leq Y\}$.
	那么 $i_!(U)=U$, $i^*(U)=U\land Y$ 满足 Frobenius 恒等式.
	
	另一方面, 设子位象的嵌入 $i\colon Y\to X$ 是开映射. 因为 $i^*$ 为满射而 $i_!\dashv i^*$ (这导致 $i^*i_!i^*=i^*$), 所以 $i_!$ 为单射. 令 $W = i_!(\top)$ ($\top$ 是 $\mathcal O(Y)$ 的最大元), 那么 Frobenius 恒等式给出 
	$i_!i^*(V) = W\land V$ ($V\in\mathcal O(X)$). 进而有
	\[
		\{V\in\mathcal O(X)\mid V\leq W\}
		\{V\in\mathcal O(X)\mid V=i_!i^*(V)\}
		= \operatorname{im}i_!.
	\]
	这说明 $Y$ 是由 $W$ 确定的开子位象.
\end{proof}

\begin{example}
	{(到点的映射)}
	对于位象 $X$, 映射 $X\to 1$ 是开映射.\footnotemark{} %\todo{真的吗?}
	这是因为 $X^*\colon \mathcal O(1)\to\mathcal O(X)$ 有左伴随
	\[
	X_!\colon U\mapsto\begin{cases}
		\top & U\neq \bot\\
		\bot & U = \bot
	\end{cases},
	\]
	而 Frobenius 恒等式 $X_!(U\land X^*(V)) = X_!(U)\land V$ 对 $V=\top,V=\bot$ 均成立.
\end{example}

\footnotetext{注意这个命题依赖于排中律: 左伴随 $X_!$ 的构造使用了排中律, $\mathcal O(1)=\{\top,\bot\}$ 的事实也需要排中律. 在没有排中律时, 也可以证明映射 $X\to 1$ 是开映射当且仅当 $X^*\colon \mathcal O(1)\to\mathcal O(X)$ 有左伴随. 称满足该条件的位象 $X$ 为\emph{开位象}.}

\todo{留下经典逻辑的讨论, 将内位象的讨论移到内语言那一章?}

\begin{prop}
	{(离散空间)}
	位象 $X$ 是\emph{离散空间}, 即 $\mathcal O(X)$ 作为\fm{}同构于某个集合的幂集, 当且仅当 $\Delta\colon X\to X\times X$ 是开映射.
\end{prop}
\begin{proof}
	定义集合
	\[
	X_0 = \{\text{开子空间 $A\hookrightarrow X$} \mid A\times A\subset \Delta\subset X\times X,\,X_!A=\top\}.
	\]
	其中条件 $X_!A=\top$ 在经典逻辑中等价于 $A\neq\bot$.
	考虑映射
	\[
	\phi\colon \mathcal O(X) \to P(X_0),\,
	U\mapsto \{A\in X_0\mid A\leq U\}.
	\]
	\todo{}
\end{proof}

\subsection{局部位象}

\begin{definition}
	{(局部位象)}
	称位象 $X$ 为\emph{局部位象}是指 $X$ 的任何开覆盖都包含 $X$ 自身; 即对任意一族元素 $\{U_i\}_{i\in I}\subset O(X)$, 若 $\bigvee_i U_i = \top$, 则存在 $i$ 使得 $U_i=\top$.
\end{definition}

\begin{example}
	{(局部拓扑空间)}
	设 $X$ 为清晰空间 (定义 \ref{sober-space}), 例如 Hausdorff 空间.
	那么 $X$ 为局部位象当且仅当 $X$ 中存在一点 $x$, 其唯一的邻域是 $X$ 本身.
\end{example}

\begin{example}
	{(局部环的谱是局部位象)}
	在经典逻辑中, \emph{局部环}是指仅有一个极大理想的环. 一般地, 称环 $R$ 为局部环是指对任意 $x,y\in R$, 若 $x+y$ 可逆, 则 $x$ 可逆或 $y$ 可逆.
	局部环 $R$ 的谱 $\operatorname{spec}R$ 是局部位象, 事实上, 考虑 $R$ 的极大理想对应的 $\operatorname{spec}R$ 的点, 其唯一的邻域是 $\operatorname{spec}R$ 本身.
\end{example}

%\todo{Elephant C1.5.6}
\begin{prop}
	{}
	位象 $X$ 是局部位象当且仅当 $X_*\colon \mathcal O(X)\to \mathcal O(1)$ 有右伴随.
\end{prop}
\begin{proof}
%	假设 $X_*$ 有右伴随, 那么 $X_*$ 保持所有极限和余极限, 故存在位象态射 $p\colon 1\to X$, $p^*\dashv p_*$, 使得 $X_*=p^*$. 因此
%	\[
%	\{U\in\mathcal O(X) \mid p^*(U)=\top\} = \{U\in\mathcal O(X) \mid X_*(U)=\top\} = \{X\}.
%	\]
%	\todo{}
%	
	$X_*$ 有右伴随当且仅当 $X_*$ 保持任意并, 而 $X_*(U)=\begin{cases}
		\top & U=\top\\
		\bot & U< \top
	\end{cases}$, 故 $X_*$ 保持任意并当且仅当 $\big(\bigvee_{U<\top} U\big) < \top$, 即 $X$ 为局部位象.
\end{proof}

\subsection{局部连通位象}

\begin{definition}
	[label={connected-locale}]
	{(连通位象)}
	称位象 $X$ \emph{连通}, 是指对任意\emph{两两不交}的一族元素 $\{U_i\}_{i\in I}\subset\mathcal O(X)\,(i\neq j\Rightarrow U_i\land U_j=\bot)$, 若 $\bigvee_i U_i = \top$, 则存在 $i$ 使得 $U_i = \top$.
\end{definition}

%\begin{prop}
%	{(连通性的等价定义)}
%	位象 $X$ 是连通位象
%\end{prop}

% Elephant C1.5.9 写在意象的几何性质那一节?

\begin{definition}
	[label={locally-connected-locale}]
	{(局部连通位象)}
	称位象 $X$ \emph{局部连通} (locally connected), 是指其任何开子位象都可写成若干个连通的开子位象的并.
\end{definition}

由定义, 可知 ``局部连通'' 是一种\emph{局部性质}, 即当 $X$ 有开覆盖 $X=\bigvee_i U_i$ 时, $X$ 局部连通当且仅当每个 $U_i$ 局部连通.

\begin{propdef}
	{(连通分支)}
	局部连通位象 $X$ 可唯一地分解为连通开子位象的不交并 $X=\bigvee_i X_i$, 称每个 $X_i$ 为 $X$ 的\emph{连通分支} (component).
\end{propdef}
\begin{proof}
	由定义, $X$ 是若干个连通开子位象 $U_j$ 的并. 在这些开子位象之间, ``相交非空'' 的关系生成一个等价关系 $\sim$, 取 $X_i$ 为每个等价类中所有成员的并即可.
\end{proof}

%\begin{prop}
%	{(局部连通性的等价条件)}
%	位象 $X$, 局部连通当且仅当 $X^*\mathcal O(1)\to\mathcal O(X)$ 有左伴随 $X_!$.
%\end{prop}
%\begin{proof}
%	\todo{}
%	% C1.5.9
%	设 $X$ 局部连通, 定义 $X_!\colon \mathcal O(X)\to \mathcal O(1)$
%\end{proof}

在 \ref{topos-geometric-properties} 节, 我们将用层范畴的性质来刻画位象的 (局部) 连通性等几何性质, 并由此类比得到\topos{}的几何性质的定义.

\section{位象与逻辑}

\label{locales-and-logic}

\philoquote{[A locale is a] propositional geometric theory pretending to be a space.}{Steven Vickers}

% frame = complete Heyting algebra (但作为范畴不同构)

%我们将建立如下对应.
%
%\begin{itemize}
%	\item 位象 = 命题逻辑理论
%	\item 开集 = 命题
%	\item 点 = 模型
%\end{itemize}

% https://q.uiver.app/#q=WzAsOSxbMCwwLCJcXHRleHR756m66Ze0fSJdLFsyLDAsIlxcdGV4dHvnkIborrp9Il0sWzIsMSwiXFx0ZXh0e+aooeWei30iXSxbMCwxLCJcXHRleHR754K5fSJdLFswLDIsIlxcdGV4dHvlvIDpm4Z9Il0sWzIsMiwiXFx0ZXh0e+WRvemimH0iXSxbMSwxLCJcXHRleHR757Sg55CG5oOzfSJdLFsxLDIsIlxcdGV4dHvlh73mlbB9Il0sWzEsMCwiXFx0ZXh0e+WHveaVsOeOr30iXSxbMyw2LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFs2LDIsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzQsNywiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XSxbNyw1LCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifSwiaGVhZCI6eyJuYW1lIjoibm9uZSJ9fX1dLFswLDgsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9LCJoZWFkIjp7Im5hbWUiOiJub25lIn19fV0sWzgsMSwiIiwwLHsic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn0sImhlYWQiOnsibmFtZSI6Im5vbmUifX19XV0=
\[\begin{tikzcd}[ampersand replacement=\&,row sep=small]
	{\text{空间}} \& {\text{代数}} \& {\text{理论}} \\
	{\text{点}} \& {\text{素理想}} \& {\text{模型}} \\
	{\text{开集}} \& {\text{元素}} \& {\text{命题}}
	\arrow[dashed, no head, from=2-1, to=2-2]
	\arrow[dashed, no head, from=2-2, to=2-3]
	\arrow[dashed, no head, from=3-1, to=3-2]
	\arrow[dashed, no head, from=3-2, to=3-3]
	\arrow[dashed, no head, from=1-1, to=1-2]
	\arrow[dashed, no head, from=1-2, to=1-3]
\end{tikzcd}\]

建议在阅读本节之前阅读附录 \ref{first-order-languages} 节.
%, 尤其关注几何逻辑的内容.


\subsection{经典命题逻辑与 Boole 代数}

Lindenbaum 代数是用代数方法研究逻辑的工具. 粗略地说, 它是一个理论中的 ``命题的代数''; 在经典逻辑的情形, 它就是 \emph{Boole 代数} (定义 \ref{Boolean-algebra}). 根据 Stone 表示定理, Boole 代数在代数--几何对偶中对应 \emph{Stone 空间}.

设 $\Sigma$ 是由若干命题符号 $p,q,r,\cdots$ 组成的符号表\footnote{在定义 \ref{def-first-order-signature} 的框架中, 我们可以说 $\Sigma$ 包括 $0$ 个类型, $0$ 个函数符号 (固然, 因为 $\Sigma$ 中没有类型), 以及若干个 $0$ 元关系符号 $p,q,r,\cdots$. 这样的理论也成为\emph{零阶理论} (zeroth-order theory).}.
定义 $\mathsf {Sen}_\Sigma$ 为 $\Sigma$ 上由 $\lor$, $\land$, $\neg$, $\Rightarrow$, $\top$, $\bot$ 组成的公式\footnote{这里的公式也可以放在定义 \ref{formula} 的框架中. 注意, 在这个框架中没有等式 $p=q$, 因为 $p,q$ 不是某个类型的项 ($\Sigma$ 中没有类型), 而是 $0$ 元关系符号.}的集合, 包括 $(p\land q)\Rightarrow r$, $p\lor\neg p$, $p\Rightarrow\bot$ 等等.

\newcommand{\LA}{\mathcal {LA}}

\begin{definition}
	{}
	在经典逻辑中, 对于符号表 $\Sigma$ 上的命题理论 $\mathbb T$ (即一些公理的集合), 定义 $\mathbb T$ 的 \emph{Lindenbaum 代数} $\LA_{\mathbb T}$ 为 $\Sigma$ 上公式的 $\mathbb T$-\emph{可证等价类}构成的 Boole 代数:
	$$
	\LA_{\mathbb T} := \mathsf {Sen}_\Sigma \big/ {\equiv_{\mathbb T}},\quad
	\text{其中 $\phi\equiv_{\mathbb T} \psi$ 当且仅当 $\mathbb T$ 可证 $\phi\Leftrightarrow\psi$}.
	$$
\end{definition}

\begin{definition}
	{(命题理论之间的态射)}
	对于两个命题理论 $(\Sigma,\mathbb T)$, $(\Sigma',\mathbb T')$, 定义态射 $f\colon \mathbb T \to \mathbb T'$ 为映射 $f\colon \Sigma \to \mathsf {Sen}_{\Sigma'}$, 它自然诱导映射 $\mathsf {Sen}_\Sigma\to \mathsf {Sen}_{\Sigma'}$, 使得 $f$ 保持公理, 即 $f(\mathbb T)\subset \mathbb T'$. 等价地, $f$ 为 Boole 代数同态 $\LA_{\mathbb T} \to \LA_{\mathbb T'}$.
\end{definition}

\begin{remark}
	{}
	命题理论的态射可类比于环同态: 对于两个环 $R=\mathbb{Z}[x_1,\cdots,x_n]/I$ 与 $R'=\mathbb{Z}[y_1,\cdots,y_m]/J$, 环同态 $f\colon R\to R'$ 为映射 $\{x_1,\cdots,x_n\}\to R'$ (它自然诱导映射 $\mathbb{Z}[x_1,\cdots,x_n]\to \mathbb{Z}[y_1,\cdots,y_m]$), 使得 $f(I)\subset J$.
\end{remark}

\begin{definition}
	{(命题理论的模型)}
	一个命题理论 $(\Sigma,\mathbb T)$ 的\emph{标准模型}\footnotemark (standard model, 又称\emph{解释}, interpretation) 是一个函数 $f\colon \Sigma \to \{\top,\bot\}$, 它自然诱导一个映射 $\bar f\colon \mathsf {Sen}_\Sigma\to\{\top,\bot\}$, 使得 $\bar f(\mathbb T)\subset \{\top\}$. 记 $\mathbb T$ 的经典模型的集合为 $\text{Mod}(T)$.
	
	一般地, 对任意 Boole 代数 $A$, $(\Sigma,\mathbb T)$ 的 \emph{$A$-模型}是一个映射 $f\colon \Sigma \to A$, 它自然诱导一个映射 $\bar f\colon \mathsf {Sen}_\Sigma\to A$, 使得 $\bar f(\mathbb T)\subset \{\top\}$. 记 $\mathbb T$ 的 $A$-模型的集合为 $\text{Mod}_A(\mathbb T)$. 恒等映射 $\operatorname{id}_{\LA_{\mathbb T}}$ 是 $\mathbb T$ 的万有模型 (generic model), 意指任何模型都可由万有模型通过一个 Boole 代数同态得到.
\end{definition}
\footnotetext{此处 ``标准模型'' 并不是 ``唯一的模型'' 的意思, 而是在标准意义下的模型.}


\begin{prop}
	[label={model-boolealg-homomorphism}]
	{}
	对任意 Boole 代数 $A$, 命题理论 $(\Sigma,\mathbb T)$ 的 $A$-模型一一对应于 Boole 代数同态 $\LA_{\mathbb T} \to A$.
\end{prop}

\begin{proof}
	设 $f\colon \Sigma\to A$ 为 $\mathbb T$ 的 $A$-模型. 我们需要证明 $\bar f\colon \mathsf {Sen}_\Sigma\to A$ 将 $\mathbb T$-等价的公式对应到相同的元素. 若 $\phi \equiv_{\mathbb T} \psi$, 设 $\mathbb T$ 对 $\phi \Leftrightarrow\psi$ 的证明用到了公理 $t_1,\cdots,t_n$, 那么由经典逻辑的性质可知
	$$
	\big( \bar f(t_1) \land \cdots \land \bar f (t_n) \big) \leq \big( \bar f(\phi) \Leftrightarrow \bar f(\psi) \big),
	$$
	但由 $f$ 是 $\mathbb T$ 的 $A$-模型, $\bar f(t_1)=\cdots = \bar f(t_n) = \top\in A$, 这说明 $\bar f(\phi) = \bar f(\psi)$.
\end{proof}

\begin{remark}
	{}
	上述命题可类比于环同态的如下性质:
	对于多项式 $f_1,\cdots,f_m\in \mathbb{Z}[x_1,\cdots,x_n]$ 以及任何环 $A$, 集合
	$$
	\big\{
	(a_1,\cdots,a_n)\in A^n\mid f_i(a_1,\cdots,a_n)=0\,(i=1,2,\cdots,m)
	\big\}
	$$
	一一对应于环同态 $\mathbb{Z}[x_1,\cdots,x_n]/(f_1,\cdots,f_m) \to A$.
\end{remark}

\begin{remark}
	[label={model-and-ultrafilter}]
	{}
	由上述命题, $\mathbb T$ 的经典模型一一对应于 Boole 代数同态 $\LA_{\mathbb T} \to \{\top,\bot\}$, 即 $\LA_{\mathbb T}$ 的\emph{超滤}.
	回忆位象 $X$ 的点是\fm{}同态 $\mathcal O(X) \to \{\top,\bot\}$, 即 $\mathcal O(X)$ 的完全素滤子. 两种情形的区别在于逻辑规则: Boole 代数中没有任意并, 而有排中律; \fm{}中有任意并, 没有排中律.
\end{remark}

\begin{prop}
	{}
	命题理论的态射 $f\colon (\Sigma,\mathbb T) \to (\Sigma',\mathbb T')$ 诱导模型的映射 $\text{Mod}_A(\mathbb T') \to \text{Mod}_A(\mathbb T)$.
\end{prop}

注意方向的反转 (这是代数--几何对偶的一部分).
%集合 $\text{Mod}(\mathbb T)$ 可附加一个拓扑, 以 $\{f\in\text{Mod}(\mathbb T)\mid \bar f(\phi)=\top\}$ 为开集基 ($\phi$ 取所有公式).

命题理论的 (经典) 模型的集合可赋予一个拓扑, 就像环的谱可赋予拓扑一样 (注 \ref{completely-prime-filter-vs-prime-ideal}).

\begin{definition}
	{(Boole 代数的谱)}
	对 Boole 代数 $B$, 定义拓扑空间 $\operatorname{Spec}(B)$ 如下, 其点集为 $\operatorname{Hom}_{\mathsf {BooleAlg}}(B,\{\top,\bot\})$ (注意同态 $f\colon B\to\{\top,\bot\}$ 一一对应于素滤子 $f^{-1}(\top)$), 一个开集基为 $\big\{\{f\mid f(b)=\top\}\big\}_{b\in B}$.
\end{definition}

\begin{propdef}
	{(Stone 空间)}
	对于拓扑空间 $X$, 以下条件等价:
	\begin{itemize}
		\item $X$ 是紧 Hausdorff 空间, 且完全不连通 (仅有的连通分支为单点集);
		\item $X$ 紧, 且完全分离 (任何两个不同的点都能被一个既开又闭子集分开);
		\item $X$ 是\emph{投射有限空间}, 即有限离散空间的投射极限.
	\end{itemize}
	称满足上述条件的空间为 \emph{Stone 空间}.
\end{propdef}

\begin{prop}
	{}
	设 $B$ 是 Boole 代数, 那么 $\operatorname{Spec}(B)$ 是 Stone 空间.
\end{prop}

\begin{proof}
	首先证明 $\operatorname{Hom}_{\mathsf {BooleAlg}}(B,\{\top,\bot\})$ 是紧空间. 这是因为, 它是积空间 $\{\top,\bot\}^{B}$ 的闭子集, 而由 Tychonoff 定理, 紧空间的任意乘积是紧空间.%, 故 $\{\top,\bot\}^{B}$ 是紧空间, 从而 $\operatorname{Hom}_{\mathsf {BooleAlg}}(B,\{\top,\bot\})$ 是紧空间.
	
	然后证明 $\operatorname{Hom}_{\mathsf {BooleAlg}}(B,\{\top,\bot\})$ 是完全分离空间. 对其中任意不同的两点 $p,q$,
	不妨设存在 $b\in B$ 使得 $p(b)=\top,q(b)=\bot$.
	那么 $p(\neg b)=\bot$ 而 $q(\neg b)=\top$.
	因此, $\operatorname{Spec}(B)$ 的既开又闭子集
	$\{f\mid f(b)=\top\}$, $\{f\mid f(\neg b)=\top\}$ 将 $p,q$ 分离.
\end{proof}

\begin{example}
	{(Tarski 代数与 Cantor 空间)}
	Tarski 证明了可数无原子 Boole 代数在同构意义下唯一, 不妨称之为 \emph{Tarski 代数}. (原子的定义见例 \ref{complete-atomless-Boolean-algebra}.) 其一种构造是可数个变量生成的自由 Boole 代数, 也即可数个命题符号上的\emph{空理论} (即没有公理的理论) 的 Lindenbaum 代数.
	
	著名的 Cantor 空间 $\big\{\sum_{n\geq 1}a_n3^{-n}\mid a_n\in\{0,2\}\big\}\subset \mathbb{R}$ 作为拓扑空间同胚于 $\{\top,\bot\}^{\mathbb{N}}$. 容易证明 Cantor 空间是 Stone 空间, 也是 Tarski 代数的谱.
\end{example}

\begin{prop}
	[label={Stone-duality}]
	{(Stone 对偶)}
	
	Boole 代数与 Stone 空间之间有如下 (反变的) 范畴等价
	% https://q.uiver.app/#q=WzAsMixbMCwwLCJcXG1hdGhzZiB7Qm9vbGVBbGd9Il0sWzIsMCwiXFxtYXRoc2Yge1N0b25lU3B9Il0sWzAsMSwiXFxvcGVyYXRvcm5hbWV7SG9tfSgtLFxce1xcdG9wLFxcYm90XFx9KSIsMix7Im9mZnNldCI6Mn1dLFsxLDAsIlxcb3BlcmF0b3JuYW1le0hvbX0oLSxcXHtcXHRvcCxcXGJvdFxcfSkiLDIseyJvZmZzZXQiOjJ9XV0=
	\[\begin{tikzcd}[ampersand replacement=\&]
		{\mathsf {BooleAlg}^{\op}} \&\& {\mathsf {StoneSp}.}
		\arrow["{\operatorname{Spec}}"', shift right=2, from=1-1, to=1-3]
		\arrow["{\operatorname{Hom}_{\mathsf {StoneSp}}(-,\{\top,\bot\})}"', shift right=2, from=1-3, to=1-1]
	\end{tikzcd}\]
\end{prop}

\begin{proof}
	设 $B$ 为 Boole 代数. 定义 $\alpha\colon B\to\operatorname{Hom}(\operatorname{Spec}(B),\{\top,\bot\})$, $x\mapsto (f\mapsto f(x))$. 很明显 $\alpha$ 是 Boole 代数同态.
	\begin{itemize}
		\item $\alpha$ 是单射: 对不同的元素 $x,y\in B$, 取素滤子 $F$ 包含 $x\land (\neg y)$, 那么它对应的同态 $f\colon B\to\{\top,\bot\}\in\operatorname{Spec}(B)$ 满足 $f(x)=\top,f(y)=\bot$.
		\item $\alpha$ 是满射: 对任意连续映射 $\varphi\colon \operatorname{Spec}(B)\to\{\top,\bot\}$, 既开又闭子集 $\varphi^{-1}(\top)$ 可写为开集基中有限个元素的并 (这是由于紧性), 那么 $\varphi^{-1}(\top) =\bigcup_i \{f\mid f(b_i)=\top\} = \{f\mid f(\lor_i b_i)=\top\}$, $\varphi=\alpha(\lor_i b_i)$. 由此我们还得到结论: 对任意 Boole 代数 $B$, $\operatorname{Spec} (B)$ 的既开又闭子集必然形如 $\{f\mid f(b)=\top\}$ ($b\in B$).
	\end{itemize}
	设 $S$ 为 Stone 空间. 定义 $\beta\colon S\to\operatorname{Spec}(\operatorname{Hom}(S,\{\top,\bot\}))$, $p\mapsto (\varphi\mapsto \varphi(p))$.
	\begin{itemize}
		\item $\beta$ 是单射:
		对不同的两点 $p,q\in S$, 由 Stone 空间的定义存在既开又闭子集 $U$, 包含 $p$ 但不包含 $q$. 这给出了 $\varphi\in\operatorname{Hom}(S,\{\top,\bot\})$, 使得 $\varphi(p)\neq\varphi(q)$, 那么 $\beta(p)\neq\beta(q)$.
		\item $\beta$ 是满射:
		对任意 $f\colon \operatorname{Hom}(S,\{\top,\bot\}) \to \{\top,\bot\}$,
		将 $\operatorname{Hom}(S,\{\top,\bot\})$ 视为 $S$ 的既开又闭子集构成的 Boole 代数,
		那么 $f(\varnothing)=\bot$, 所以 $f^{-1}(\top)$ 中任意有限个成员都相交.
		由 $S$ 的紧性, 这说明 $f^{-1}(\top)$ 中所有成员相交于某个点 $p\in S$. 因此 $f^{-1}(\top)$ 是所有包含 $p$ 的既开又闭子集, 即 $f=\beta(p)$.
		\item $\beta$ 连续:
		任取 $\varphi\in \operatorname{Hom}(S,\{\top,\bot\})$.
		$\operatorname{Spec}(\operatorname{Hom}(S,\{\top,\bot\}))$ 的既开又闭子集 $\{f\mid f(\varphi)=\top\}$ 的原像为
		$\{p\in S\mid \varphi(p)=\top\}$, 也是 $S$ 的既开又闭子集. 这实际上已经证明 $\beta$ 为同胚.
	\end{itemize}
\end{proof}


\subsection{几何逻辑与\fm{}}

仍设 $\Sigma$ 是由若干命题符号组成的符号表. 回忆\emph{几何公式}由命题符号, 真 $\top$, 有限合取 $\land$ 以及无穷析取 $\bigvee$ 构成, 由此还包含假 $\bot=\bigvee\varnothing$, 参见定义 \ref{kinds-of-formulae}. 一个\emph{几何命题理论} (geometric propositional theory) 由若干相继式 $\phi\vdash\psi$ 组成, 其中 $\phi,\psi$ 为几何公式. 几何逻辑允许使用如下推理规则,
\begin{itemize}
	\item 有限合取规则,
	\[
	\phi\vdash\top,\quad
	\phi\land\psi\vdash\phi,\quad
	\phi\land\psi\vdash\psi,\quad
	\sqc{\phi\vdash\psi\quad \phi\vdash\chi}{\phi\vdash (\psi\land\chi)}.
	\]
	\item 无限析取规则,
	\[
	\phi \vdash \bigvee S\, (\phi\in S),\quad
	\sqc{\text{对所有 $\phi\in S$, } \phi\vdash\psi}{\bigvee S \vdash \psi}.
	\]
	\item 无限分配公理
	\[
	\phi\wedge (\bigvee S) \ \vdash \ \bigvee \{\phi\wedge \psi\mid\psi\in S\}.
	\]
\end{itemize}
参见定义 \ref{inference-rules}.

\begin{definition}
	{}
	设 $\mathbb T$ 为 $\Sigma$ 上的几何理论. 定义 $\mathbb T$ 的 \emph{Lindenbaum 代数} $\LA_{\mathbb T}$ 为 $\Sigma$ 上\emph{几何公式}的 $\mathbb T$-\emph{可证等价类}构成的\fm{}. 当然, 其上的序关系 $\leq$ 是 $\vdash$.
\end{definition}

\begin{remark}
	[label={frame-from-generators-relations}]
	{(生成元与关系)}
	上面的推理规则保证公式的可证等价类构成\fm{}; 它可视为由 $\Sigma$ 中的命题符号作为\emph{生成元}, $\mathbb T$ 中的公理作为\emph{关系}生成的\fm{}. 这里的关系可以是不等式 $p\leq q$, 也可以是等式 $p=q$ (两者可以互相转化, $p\leq q$ 等价于 $p\land q = p$, $p=q$ 等价于 $p\leq q,q\leq p$). 向一个理论 $\mathbb T$ 添加公理, 相当于添加\fm{}生成元之间的关系, 因此对应于取 $\LA_{\mathbb T}$ 的子位象 (定义 \ref{sublocales}).
	
	与 Lawvere 理论不同, \fm{}的结构包含了任意集合大小的运算, 一般而言这可能导致所有公式的 ``集合'' 过大而不构成集合. 但\fm{}的特殊性在于, 任何公式都 (在 $\mathbb T$-可证的意义下) 等同于 $\Sigma$ 中的符号先取有限交再任意并的形式, 正如点集拓扑学中由\emph{子基} (subbasis) 生成拓扑一样. 因此全体公式的可证等价类确实是一个集合.
\end{remark}


\begin{definition}
	{(几何理论的模型)}
	对\fm{} $A$, $\mathbb T$ 的 $A$-模型是一个函数 $f\colon \Sigma\to A$, 它自然诱导几何公式 (的等价类) 到 $A$ 的映射 $\bar f$, 使得 $\bar f(\mathbb T)\subset \{\top\}$. \emph{标准模型}是指取值于\fm{} $\{\top,\bot\}$ 的模型.
\end{definition}

与命题 \ref{model-boolealg-homomorphism} 完全类似, 有如下的事实.
\begin{prop}
	{}
	几何理论 $\mathbb T$ 的 $A$-模型一一对应于\fm{}同态 $\LA_{\mathbb T}\to A$. 特别地, $\mathbb T$ 的标准模型一一对应于位象 $\LA_{\mathbb T}$ 的\emph{点}.
\end{prop}

\begin{remark}
	[label={classifying-locale}]
	{(直观: 分类空间)}
	$\LA_{\mathbb T}$ 对应的位象可想象为 ``$\mathbb T$ 的模型的空间'', 它是一种 ``分类空间''; 上述命题印证了这一直观: ``$\mathbb T$ 的模型的空间'' 中的点正是 $\mathbb T$ 的模型. 但是一个空间不能由它的点完全决定, 正如一个理论不能由它的 (标准) 模型完全决定.
\end{remark}

\begin{example}
	{(一些简单的几何理论)}
	\begin{itemize}
		\item 记 $\mathbb T_{-1}$ 为零个命题符号与一条公理 $\top\vdash \bot$ 构成的理论, 这是一个\emph{不相容} (inconsistent) 的理论,
		\[
		\LA_{\mathbb T_{-1}} = \{\bot\},
		\]
		它对应空位象 $\varnothing$ (例 \ref{initial-locale}).
		\item 记 $\mathbb T_0$ 为零个命题符号与零条公理构成的理论, 则
		\[
		\LA_{\mathbb T_0} = \{\bot \to \top\},
		\]
		它对应终位象 $1$ (例 \ref{terminal-locale}).
		\item 记 $\mathbb T_1$ 为一个命题符号 $p$ 与零条公理构成的理论, 则
		\[
		\LA_{\mathbb T_1} =
		\{
		\bot \to p \to \top
		\}.
		\]
		它是一个元素生成的自由\fm{}, 对应 Sierpi\'nski 空间 $S$ (例 \ref{Sierpinski-space-locale-example}).
		$S$ 有两个点 $\top, \bot$, 分别对应 $\mathbb T_1$ 的两个标准模型.
		\item 记 $\mathbb T_2$ 为两个命题符号 $p,q$ 与零条公理构成的理论, 则
		\[
		\LA_{\mathbb T_2} =
		\left\{
		% https://q.uiver.app/#q=WzAsNixbMCwxLCJcXGJvdCJdLFsxLDEsInBcXGxhbmQgcSJdLFsyLDAsInAiXSxbMiwyLCJxIl0sWzMsMSwicFxcbG9yIHEiXSxbNCwxLCJcXHRvcCJdLFswLDFdLFsxLDJdLFsyLDRdLFs0LDVdLFsxLDNdLFszLDRdXQ==
		\begin{tikzcd}[ampersand replacement=\&,sep=tiny]
			\&\& p \\
			\bot \& {p\land q} \&\& {p\lor q} \& \top \\
			\&\& q
			\arrow[from=2-1, to=2-2]
			\arrow[from=2-2, to=1-3]
			\arrow[from=1-3, to=2-4]
			\arrow[from=2-4, to=2-5]
			\arrow[from=2-2, to=3-3]
			\arrow[from=3-3, to=2-4]
		\end{tikzcd}
		\right\}.
		\]
		它是两个元素生成的自由\fm{}, 对应位象 $S\times S$.
		$S\times S$ 有四个点 $(\top,\top), (\top,\bot), (\bot,\top), (\bot,\bot)$, 分别对应 $\mathbb T_2$ 的四个标准模型.
		\item 记 $\mathbb T_3$ 为两个命题符号 $p,q$ 与一条公理 $p\vdash q$ 构成的理论, 则
		\[
		\LA_{\mathbb T_3} =
		\{
		\bot \to p \to q \to \top
		\}.
		\]
		它是 $\LA_{\mathbb T_2}$ 在等价关系 $p\land q\equiv p,\, q\equiv p\lor q$ 下的商, 对应 $S\times S$ 的一个子位象,
		其中有三个点
		$(\top,\top), (\bot,\top), (\bot,\bot)$, 分别对应 $\mathbb T_3$ 的三个标准模型.
	\end{itemize}
\end{example}

\begin{prop}
	{}
	对任意位象 $X$, 都存在一个几何理论 $\mathbb T_X$ 以 $\mathcal O(X)$ 为 Lindenbaum 代数.
\end{prop}
\begin{proof}
	定义理论 $\mathbb T_{X}$ 包含命题符号 $P_{U}\,(U\in \mathcal O(X))$, 且有如下公理.
	\begin{itemize}
		\item $\vdash P_{\top}$;
		\item 对 $\mathcal O(X)$ 中每两个满足 $U\leq V$ 的元素, 有一条公理 $P_U \vdash P_V$;
		\item 对 $\mathcal O(X)$ 中每两个元素 $U,V$, 有一条公理 $P_U \land P_V \vdash P_{U\land V}$;
		\item 对 $\mathcal O(X)$ 中每一族元素 $\{U_i\}$, 有一条公理 $P_{\bigvee_i U_i} \vdash \bigvee_i P_{U_i}$.
	\end{itemize}
	容易看到, 几何公式的 $\mathbb T_{X}$-可证等价类一一对应于 $\mathcal O(X)$ 的元素, 且逻辑连接词 $\land,\bigvee$ 与\fm{}中的结构吻合.
\end{proof}

\begin{remark}
	{}
	理论 $\mathbb T_X$ 可视为位象 $X$ 的\emph{内语言}, 其在\topos{}理论中的类比即是 \ref{Mitchell--Benabou-language} 节介绍的 Mitchell--B\'enabou 语言.
\end{remark}

\begin{example}
	{(实数位象)}
	实数位象可由如下几何理论 $\mathbb T_{\mathbb{R}}$ 给出: 其中包含命题符号 $P_{a,b}\,(a,b\in \mathbb{Q})$, 直观为 ``某实数属于开区间 $(a,b)$'', 且有如下的公理.
	\begin{itemize}
		\item 对每组 $a,a',b,b'\in\mathbb{Q}$, 有两条公理
		\[
		P_{a,b}\land P_{a',b'} \dashv\vdash \bigvee \{P_{c,d}\mid \max(a,a')<c<d<\min(b,b')\},
		\]
		($\phi\dashv\vdash\psi$ 表示 $\phi\vdash\psi$ 与 $\psi\vdash\phi$)
		\item 对每个 $\varepsilon>0,\varepsilon\in \mathbb{Q}$, 有一条公理
		\[
		\top\vdash\bigvee\{P_{q-\varepsilon,q+\varepsilon}\mid q\in \mathbb{Q}\}.
		\]
	\end{itemize}
	理论 $\mathbb T_{\mathbb{R}}$ 的一个标准模型为一个实数 (由 Dedekind 分割定义).
\end{example}
% sublocale 与 product locale 对应的理论是什么


%\subsection{分类位象}

% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXHRleHR76Zu26Zi26YC76L6RfSJdLFswLDEsIlxcdGV4dHtMaW5kZW5iYXVtLS1UYXJza2kg5Luj5pWwfSJdLFsxLDAsIlxcdGV4dHvkuIDpmLbpgLvovpF9Il0sWzEsMSwiXFx0ZXh0e+WIhuexu1xcdG9wb3N7fX0iXSxbMiwzLCIiLDAseyJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJzcXVpZ2dseSJ9fX1dLFswLDEsIiIsMCx7InN0eWxlIjp7ImJvZHkiOnsibmFtZSI6InNxdWlnZ2x5In19fV1d
\[\begin{tikzcd}[ampersand replacement=\&]
	{\text{零阶逻辑}} \& {\text{Lindenbaum--Tarski 代数}} \\
	{\text{一阶逻辑}} \& {\text{分类\topos{}}}
	\arrow[squiggly, from=1-2, to=2-2]
	\arrow[squiggly, from=1-1, to=2-1]
\end{tikzcd}\]

